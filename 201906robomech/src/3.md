# 開発したシステム
## システム概要
本研究では、センサーデータを蓄積するためのプラットフォームのプロトタイプを構築することが目標である。ここで蓄積するデータはROSのトピックに含まれるメッセージに場所データを表すデータを追加したものとする。ROSがトピックをPublishすると同時にサーバーへ場所データを付与したトピックのメッセージをHTTPのPOSTリクエストとして送信し、クラウド上のデータベースに保存するという構成にした。  
　実際にデータをクラウド上のデータベースに保存するためにAmazon Web Services(AWS)を使用した。HTTPリクエストを受信するエンドポイントはAPI Gatewayというサービスで設定し、実際に動作するプログラムをコンピューティングサービスであるLambdaに作成した。そしてデータの保存には、様々な種類のデータへ柔軟に対応するために、スキーマ定義が不要なNoSQLデータベースであるDynamoDBを使用した。Fig.1に本システムの構成図を示す。  

![構成図](src/images/fig1.eps){ width=30% height=20% }

## ローカルPC上の構成
本研究ではROSのトピック送信用に1台ノートパソコンを使用した。このノートPCのOSはUbuntu 16.04.5 LTSであり、ROSのバージョンはKineticである。ノートPC上でroscoreを立ち上げ、Pythonで記述したパブリッシュ用のスクリプトを実行してトピックを送信した。

## 送信するデータ
トピックのパブリッシュ時にLambdaへ送信するデータは、トピックのデータとそのデータ種類、トピック名、場所データの4種類であり、それぞれのカラム名をdata、data_type、topic、locationとした。トピックのやりとりはローカルPC上で/my_dataというトピックにパブリッシュするスクリプトを書きパブリッシュと同時にHTTPリクエストを送信するように実装した。このようにして実際にDynamoDBに保存したデータをFig2に示す。ここで送信したデータはダミーデータであり、10個のランダムな数値が入った配列である。DynamoDB上では配列を直接保存できないので文字列に変換して送信している。また、場所データとして11F, Nakano Campus, Meiji UniversityとShikinomori Parkの2つの場所を文字列として送信した。idとcreatedAtの値はデータ保存時にLambdaで生成したものであり、それぞれユニークなIDとデータが生成された時間(UNIXTIME)である。

![保存されたデータ](src/images/fig2.eps){width=50% height=10% }

## AWS上の構成
本稿で構築したシステムではコンピューティングリソースとしてLambdaを利用した。これは、Lambdaはイベント駆動で処理を行って結果を返すサービスであるから、イベント駆動で動くROSと相性がよく管理コストや費用を小さく抑えられるためである。HTTPリクエストを受け取ったAPI GatewayがこのリクエストをイベントとしてLambdaに流し、これに応じてLambdaはNodeJSで記述されたハンドラ関数内の処理を行う。このハンドラ関数内で、受け取ったデータにIDやcreatedAtを付与してDynamoDBへと保存する。実際の構築やデプロイはserverless frameworkを使用して行った。serverless frameworkを使うことによってAPI GatewayやLambda、DynamoDBなどAWS上のリソースを容易に構築することが出来る。

## データの検索
場所に紐付いたデータを適切に共有するためにはデータを検索する機能が必要である。
